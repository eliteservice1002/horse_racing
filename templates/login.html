{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="en">
    <!--begin::Head-->
    <head>
        <meta charset="utf-8" />
        <title>Genesis - Data</title>
        <meta name="description" content="Updates and statistics" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700" />
        <link href="{% static 'css/login.css' %}" rel="stylesheet" type="text/css" />
        <!--begin::Global Theme Styles(used by all pages)-->
        <link href="{% static 'plugins/global/plugins.bundle.css' %}" rel="stylesheet" type="text/css" />
        <link href="{% static 'plugins/custom/prismjs/prismjs.bundle.css' %}" rel="stylesheet" type="text/css" />
        <link href="{% static 'css/style.bundle.css' %}" rel="stylesheet" type="text/css" />
        <!--end::Global Theme Styles-->
        <link rel="shortcut icon" href="{% static 'media/favicon.ico' %}" />
        
    </head>
    <!--end::Head-->
    <!--begin::Body-->
    <body id="kt_body" class="quick-panel-right demo-panel-right offcanvas-right header-fixed subheader-enabled page-loading">
        <!--begin::Main-->
        <div class="d-flex flex-column flex-root">
            <!--begin::Login-->
            <div class="login login-5 login-signin-on d-flex flex-row-fluid" id="kt_login">
                <div class="d-flex flex-center bgi-size-cover bgi-no-repeat flex-row-fluid" style="background-image: url({% static 'media/bg-login.jpg' %});">
                    <div class="login-form text-center text-white p-7 position-relative overflow-hidden" style="background-color: #000c;">
                        <!--begin::Login Header-->
                        <div class="d-flex flex-center mb-5 mt-5">
                            <a href="javascript:;">
                                <img src="{% static 'media/logo-login.png' %}" class="max-h-75px" alt="" />
                            </a>
                        </div>
                        <!--end::Login Header-->
                        <!--begin::Login Sign in form-->
                        <div class="login-signin">
                            <div class="mb-20">
                                <h3 class="opacity-40 font-weight-normal">Sign In To Admin</h3>
                                <p class="opacity-40">Enter your details to login to your account:</p>
                            </div>
                            <form class="form" id="kt_login_signin_form">
                                <div class="form-group">
                                    <input id="lusername" class="form-control h-auto rounded-pill border-0 py-4 px-8" type="text" placeholder="Username" name="username" autocomplete="off" />
                                </div>
                                <div class="form-group">
                                    <input id="lpassword" class="form-control h-auto rounded-pill border-0 py-4 px-8" type="password" placeholder="Password" name="password" />
                                </div>
                                <!--
                                <div class="form-group d-flex flex-wrap justify-content-between align-items-center px-8 opacity-60">
                                    <label class="checkbox checkbox-outline checkbox-white text-white m-0">
                                    <input type="checkbox" name="remember" />Remember me
                                    <span></span></label>
                                    <a href="javascript:;" id="kt_login_forgot" class="text-white font-weight-bold">Forget Password ?</a>
                                </div>
                                -->
                                <div class="form-group text-center mt-10">
                                    <button id="kt_login_signin_submit" class="btn btn-pill btn-primary opacity-90 px-15 py-3">Sign In</button>
                                </div>
                            </form>
                            <div class="mt-10">
                                <span class="opacity-40 mr-4">Don't have an account yet?</span>
                                <a href="javascript:;" id="kt_login_signup" class="text-white opacity-30 font-weight-normal">Sign Up</a>
                            </div>
                        </div>
                        <!--end::Login Sign in form-->
                        <!--begin::Login Sign up form-->
                        <div class="login-signup">
                            <div class="mb-20">
                                <h3 class="opacity-40 font-weight-normal">Sign Up</h3>
                                <p class="opacity-40">Enter your details to create your account</p>
                            </div>
                            <form class="form text-center" id="kt_login_signup_form">
                                <div class="form-group">
                                    <input id="susername" class="form-control h-auto rounded-pill border-0 py-4 px-8" type="text" placeholder="Username" name="username"  autocomplete="off"/>
                                </div>
                                <div class="form-group">
                                    <input id="semail" class="form-control h-auto rounded-pill border-0 py-4 px-8" type="text" placeholder="Email" name="email" autocomplete="off" />
                                </div>
                                <div class="form-group">
                                    <input id="spassword" class="form-control h-auto rounded-pill border-0 py-4 px-8" type="password" placeholder="Password" name="password"  autocomplete="off"/>
                                </div>
                                <div class="form-group">
                                    <input class="form-control h-auto rounded-pill border-0 py-4 px-8" type="password" placeholder="Confirm Password" name="cpassword"  autocomplete="off"/>
                                </div>
                                <div class="form-group text-left px-8">
                                    <label class="checkbox checkbox-outline checkbox-white opacity-60 text-white m-0">
                                    <input type="checkbox" name="agree" />I Agree the
                                    <a href="#" class="text-white font-weight-bold">terms and conditions</a>.
                                    <span></span></label>
                                    <div class="form-text text-muted text-center"></div>
                                </div>
                                <div class="form-group">
                                    <button id="kt_login_signup_submit" class="btn btn-pill btn-primary opacity-90 px-15 py-3 m-2">Sign Up</button>
                                    <button id="kt_login_signup_cancel" class="btn btn-pill btn-outline-white opacity-70 px-15 py-3 m-2">Cancel</button>
                                </div>
                            </form>
                        </div>
                        <!--end::Login Sign up form-->
                        <!--begin::Login forgot password form-->
                        <div class="login-forgot">
                            <div class="mb-20">
                                <h3 class="opacity-40 font-weight-normal">Forgotten Password ?</h3>
                                <p class="opacity-40">Enter your email to reset your password</p>
                            </div>
                            <form class="form" id="kt_login_forgot_form">
                                <div class="form-group mb-10">
                                    <input class="form-control h-auto text-white bg-white-o-5 rounded-pill border-0 py-4 px-8" type="text" placeholder="Email" name="email" autocomplete="off" />
                                </div>
                                <div class="form-group">
                                    <button id="kt_login_forgot_submit" class="btn btn-pill btn-primary opacity-90 px-15 py-3 m-2">Request</button>
                                    <button id="kt_login_forgot_cancel" class="btn btn-pill btn-outline-white opacity-70 px-15 py-3 m-2">Cancel</button>
                                </div>
                            </form>
                        </div>
                        <!--end::Login forgot password form-->
                    </div>
                </div>
            </div>
            <!--end::Login-->
        </div>
        <!--end::Main-->
        <!--begin::Global Config(global config for global JS scripts)-->
        <script>var KTAppSettings = { "breakpoints": { "sm": 576, "md": 768, "lg": 992, "xl": 1200, "xxl": 1200 }, "colors": { "theme": { "base": { "white": "#ffffff", "primary": "#6993FF", "secondary": "#E5EAEE", "success": "#1BC5BD", "info": "#8950FC", "warning": "#FFA800", "danger": "#F64E60", "light": "#F3F6F9", "dark": "#212121" }, "light": { "white": "#ffffff", "primary": "#E1E9FF", "secondary": "#ECF0F3", "success": "#C9F7F5", "info": "#EEE5FF", "warning": "#FFF4DE", "danger": "#FFE2E5", "light": "#F3F6F9", "dark": "#D6D6E0" }, "inverse": { "white": "#ffffff", "primary": "#ffffff", "secondary": "#212121", "success": "#ffffff", "info": "#ffffff", "warning": "#ffffff", "danger": "#ffffff", "light": "#464E5F", "dark": "#ffffff" } }, "gray": { "gray-100": "#F3F6F9", "gray-200": "#ECF0F3", "gray-300": "#E5EAEE", "gray-400": "#D6D6E0", "gray-500": "#B5B5C3", "gray-600": "#80808F", "gray-700": "#464E5F", "gray-800": "#1B283F", "gray-900": "#212121" } }, "font-family": "Poppins" };</script>
        <!--end::Global Config-->
        <!--begin::Global Theme Bundle(used by all pages)-->
        <script src="{% static 'plugins/global/plugins.bundle.js' %}"></script>
        <script src="{% static 'plugins/custom/prismjs/prismjs.bundle.js' %}"></script>
        <script src="{% static 'js/scripts.bundle.js' %}"></script>
        <!--end::Global Theme Bundle-->
        <!--begin::Page Scripts(used by this page)-->
        <script>
            // Class Definition
            var KTLogin = function() {
                var _login;

                var _showForm = function(form) {
                    var cls = 'login-' + form + '-on';
                    var form = 'kt_login_' + form + '_form';
                    _login.removeClass('login-forgot-on');
                    _login.removeClass('login-signin-on');
                    _login.removeClass('login-signup-on');
                    _login.addClass(cls);
                    KTUtil.animateClass(KTUtil.getById(form), 'animate__animated animate__backInUp');
                }

                var _handleSignInForm = function() {
                    var validation;

                    // Init form validation rules. For more info check the FormValidation plugin's official documentation:https://formvalidation.io/
                    validation = FormValidation.formValidation(
                        KTUtil.getById('kt_login_signin_form'),
                        {
                            fields: {
                                username: {
                                    validators: {
                                        notEmpty: {
                                            message: 'Username is required'
                                        },
                                    }
                                },
                                password: {
                                    validators: {
                                        notEmpty: {
                                            message: 'Password is required'
                                        }
                                    }
                                }
                            },
                            plugins: {
                                trigger: new FormValidation.plugins.Trigger(),
                                submitButton: new FormValidation.plugins.SubmitButton(),
                                bootstrap: new FormValidation.plugins.Bootstrap()
                            }
                        }
                    );

                    $('#kt_login_signin_submit').on('click', function (e) {
                        e.preventDefault();

                        validation.validate().then(function(status) {
                            if (status == 'Valid') {
                                $.ajax({
                                    headers: { "X-CSRFToken": '{{csrf_token}}' },
                                    url: '{% url "ajax-signin" %}',
                                    data: {
                                        'username': $("#lusername").val(),
                                        'password': $("#lpassword").val()
                                    },
                                    type: 'POST',
                                    success: function (data) {
                                        console.log(data)
                                        if(data.err_code == "2"){
                                            location.reload();
                                        }else{
                                            swal.fire({
                                                text: data.description,
                                                icon: "error",
                                                buttonsStyling: false,
                                                confirmButtonText: "Ok, got it!",
                                                customClass: {
                                                    confirmButton: "btn font-weight-bold btn-light-primary"
                                                }
                                            }).then(function() {
                                                KTUtil.scrollTop();
                                            });
                                        }
                                    }
                                });
                            } else {
                                KTUtil.scrollTop();
                            }
                        });
                    });

                    // Handle forgot button
                    $('#kt_login_forgot').on('click', function (e) {
                        e.preventDefault();
                        _showForm('forgot');
                    });

                    // Handle signup
                    $('#kt_login_signup').on('click', function (e) {
                        e.preventDefault();
                        _showForm('signup');
                    });
                }

                var _handleSignUpForm = function(e) {
                    var validation;
                    var form = KTUtil.getById('kt_login_signup_form');

                    // Init form validation rules. For more info check the FormValidation plugin's official documentation:https://formvalidation.io/
                    validation = FormValidation.formValidation(
                        form,
                        {
                            fields: {
                                username: {
                                    validators: {
                                        notEmpty: {
                                            message: 'Username is required'
                                        }
                                    }
                                },
                                email: {
                                    validators: {
                                        notEmpty: {
                                            message: 'Email address is required'
                                        },
                                        emailAddress: {
                                            message: 'The value is not a valid email address'
                                        }
                                    }
                                },
                                password: {
                                    validators: {
                                        notEmpty: {
                                            message: 'The password is required'
                                        }
                                    }
                                },
                                cpassword: {
                                    validators: {
                                        notEmpty: {
                                            message: 'The password confirmation is required'
                                        },
                                        identical: {
                                            compare: function() {
                                                return form.querySelector('[name="password"]').value;
                                            },
                                            message: 'The password and its confirm are not the same'
                                        }
                                    }
                                },
                                agree: {
                                    validators: {
                                        notEmpty: {
                                            message: 'You must accept the terms and conditions'
                                        }
                                    }
                                },
                            },
                            plugins: {
                                trigger: new FormValidation.plugins.Trigger(),
                                bootstrap: new FormValidation.plugins.Bootstrap()
                            }
                        }
                    );

                    $('#kt_login_signup_submit').on('click', function (e) {
                        e.preventDefault();

                        validation.validate().then(function(status) {
                            if (status == 'Valid') {
                                $.ajax({
                                    headers: { "X-CSRFToken": '{{csrf_token}}' },
                                    url: '{% url "ajax-signup" %}',
                                    data: {
                                        'username': $("#susername").val(),
                                        'email': $("#semail").val(),
                                        'password': $("#spassword").val()
                                    },
                                    type: 'POST',
                                    success: function (data) {
                                        if(data.err_code == "2"){
                                            swal.fire({
                                                text: "You are registered successfully, You should wait until admin allow you",
                                                icon: "success",
                                                buttonsStyling: false,
                                                confirmButtonText: "Ok, got it!",
                                                customClass: {
                                                    confirmButton: "btn font-weight-bold btn-light-primary"
                                                }
                                            }).then(function() {
                                                _showForm('signin');
                                            });
                                            
                                        }else{
                                            swal.fire({
                                                text: data.description,
                                                icon: "error",
                                                buttonsStyling: false,
                                                confirmButtonText: "Ok, got it!",
                                                customClass: {
                                                    confirmButton: "btn font-weight-bold btn-light-primary"
                                                }
                                            }).then(function() {
                                                KTUtil.scrollTop();
                                            });
                                        }
                                    }
                                });
                            } else {
                                KTUtil.scrollTop();
                            }
                        });
                    });

                    // Handle cancel button
                    $('#kt_login_signup_cancel').on('click', function (e) {
                        e.preventDefault();

                        _showForm('signin');
                    });
                }

                var _handleForgotForm = function(e) {
                    var validation;

                    // Init form validation rules. For more info check the FormValidation plugin's official documentation:https://formvalidation.io/
                    validation = FormValidation.formValidation(
                        KTUtil.getById('kt_login_forgot_form'),
                        {
                            fields: {
                                email: {
                                    validators: {
                                        notEmpty: {
                                            message: 'Email address is required'
                                        },
                                        emailAddress: {
                                            message: 'The value is not a valid email address'
                                        }
                                    }
                                }
                            },
                            plugins: {
                                trigger: new FormValidation.plugins.Trigger(),
                                bootstrap: new FormValidation.plugins.Bootstrap()
                            }
                        }
                    );

                    // Handle submit button
                    $('#kt_login_forgot_submit').on('click', function (e) {
                        e.preventDefault();

                        validation.validate().then(function(status) {
                            if (status == 'Valid') {
                                // Submit form
                                KTUtil.scrollTop();
                            }
                        });
                    });

                    // Handle cancel button
                    $('#kt_login_forgot_cancel').on('click', function (e) {
                        e.preventDefault();

                        _showForm('signin');
                    });
                }

                // Public Functions
                return {
                    // public functions
                    init: function() {
                        _login = $('#kt_login');

                        _handleSignInForm();
                        _handleSignUpForm();
                        _handleForgotForm();
                    }
                };
            }();

            // Class Initialization
            jQuery(document).ready(function() {
                KTLogin.init();
            });
        </script>
        <!--end::Page Scripts-->
    </body>
    <!--end::Body-->
</html>